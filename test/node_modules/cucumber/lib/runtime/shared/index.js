'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _helpers = require('../../formatter/helpers');

var _stack_trace_filter = require('../stack_trace_filter');

var _stack_trace_filter2 = _interopRequireDefault(_stack_trace_filter);

var _user_code_runner = require('../../user_code_runner');

var _user_code_runner2 = _interopRequireDefault(_user_code_runner);

var _verror = require('verror');

var _verror2 = _interopRequireDefault(_verror);

var _child_process = require('child_process');

var _child_process2 = _interopRequireDefault(_child_process);

var _readline = require('readline');

var _readline2 = _interopRequireDefault(_readline);

var _command_types = require('./command_types');

var _command_types2 = _interopRequireDefault(_command_types);

var _attachment_manager = require('../attachment_manager');

var _attachment_manager2 = _interopRequireDefault(_attachment_manager);

var _step_arguments = require('../../step_arguments');

var _data_table = require('../../models/data_table');

var _data_table2 = _interopRequireDefault(_data_table);

var _step_runner = require('../step_runner');

var _step_runner2 = _interopRequireDefault(_step_runner);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _pickle_runner = require('../../pickle_runner');

var pickleRunner = _interopRequireWildcard(_pickle_runner);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Runtime = function () {
  // featuresConfig - {absolutePaths, defaultLanguage, orderSeed, filters}
  //   filters - {names, lines, tagExpression}
  //     lines - { [featurePath]: [line1, line2, ...], ... }
  // runtimeConfig - {isDryRun, isFailFast, isStrict}
  function Runtime(_ref) {
    var cwd = _ref.cwd,
        eventBroadcaster = _ref.eventBroadcaster,
        featuresConfig = _ref.featuresConfig,
        runtimeConfig = _ref.runtimeConfig,
        stepDefinitionSnippetBuilder = _ref.stepDefinitionSnippetBuilder,
        supportCodeLibrary = _ref.supportCodeLibrary,
        filterStacktraces = _ref.filterStacktraces,
        worldParameters = _ref.worldParameters;
    (0, _classCallCheck3.default)(this, Runtime);

    this.cwd = cwd;
    this.eventBroadcaster = eventBroadcaster;
    this.featuresConfig = featuresConfig;
    this.runtimeConfig = runtimeConfig;
    this.filterStacktraces = filterStacktraces;
    this.stackTraceFilter = new _stack_trace_filter2.default();
    this.stepDefinitionSnippetBuilder = stepDefinitionSnippetBuilder;
    this.supportCodeLibrary = supportCodeLibrary;
    this.worldParameters = worldParameters;
    this.testCases = {};
  }

  (0, _createClass3.default)(Runtime, [{
    key: 'getStepParameters',
    value: function () {
      var _ref3 = (0, _bluebird.coroutine)(function* (_ref2) {
        var patternMatches = _ref2.patternMatches,
            pickleArguments = _ref2.pickleArguments,
            parameterTypeNameToTransform = _ref2.parameterTypeNameToTransform,
            world = _ref2.world;

        var stepPatternParameters = yield _bluebird2.default.map(patternMatches, function (_ref4) {
          var captures = _ref4.captures,
              parameterTypeName = _ref4.parameterTypeName;

          var transform = parameterTypeNameToTransform[parameterTypeName] || function (c) {
            return c;
          };
          return _bluebird2.default.resolve(transform.apply(world, captures));
        });
        var iterator = (0, _step_arguments.buildStepArgumentIterator)({
          dataTable: function dataTable(arg) {
            return new _data_table2.default(arg);
          },
          docString: function docString(arg) {
            return arg.content;
          }
        });
        var stepArgumentParameters = pickleArguments.map(iterator);
        return stepPatternParameters.concat(stepArgumentParameters);
      });

      function getStepParameters(_x) {
        return _ref3.apply(this, arguments);
      }

      return getStepParameters;
    }()
  }, {
    key: 'runTestRunHooks',
    value: function () {
      var _ref5 = (0, _bluebird.coroutine)(function* (key, name) {
        var _this = this;

        yield _bluebird2.default.each(this.supportCodeLibrary[key], function () {
          var _ref6 = (0, _bluebird.coroutine)(function* (hookDefinition) {
            var _ref7 = yield _user_code_runner2.default.run({
              argsArray: [],
              fn: hookDefinition.code,
              thisArg: null,
              timeoutInMilliseconds: hookDefinition.options.timeout || _this.supportCodeLibrary.defaultTimeout
            }),
                error = _ref7.error;

            if (error) {
              var location = (0, _helpers.formatLocation)(hookDefinition, _this.cwd);
              throw new _verror2.default(error, name + ' hook errored, process exiting: ' + location);
            }
          });

          return function (_x4) {
            return _ref6.apply(this, arguments);
          };
        }());
      });

      function runTestRunHooks(_x2, _x3) {
        return _ref5.apply(this, arguments);
      }

      return runTestRunHooks;
    }()
  }, {
    key: 'runBeforeTestCaseHook',
    value: function runBeforeTestCaseHook(_ref8) {
      var testCaseId = _ref8.testCaseId,
          testCaseHookDefinitionId = _ref8.testCaseHookDefinitionId;
      var _testCases$testCaseId = this.testCases[testCaseId],
          world = _testCases$testCaseId.world,
          pickle = _testCases$testCaseId.pickle,
          testCase = _testCases$testCaseId.testCase;

      return _step_runner2.default.run({
        defaultTimeout: this.supportCodeLibrary.defaultTimeout,
        generateParametersFn: function generateParametersFn() {
          return [{ sourceLocation: testCase.sourceLocation, pickle: pickle }];
        },
        stepDefinition: _lodash2.default.find(this.supportCodeLibrary.beforeTestCaseHookDefinitions, ['id', testCaseHookDefinitionId]),
        world: world
      });
    }
  }, {
    key: 'runAfterTestCaseHook',
    value: function runAfterTestCaseHook(_ref9) {
      var testCaseId = _ref9.testCaseId,
          testCaseHookDefinitionId = _ref9.testCaseHookDefinitionId,
          result = _ref9.result;
      var _testCases$testCaseId2 = this.testCases[testCaseId],
          world = _testCases$testCaseId2.world,
          pickle = _testCases$testCaseId2.pickle,
          testCase = _testCases$testCaseId2.testCase;

      return _step_runner2.default.run({
        defaultTimeout: this.supportCodeLibrary.defaultTimeout,
        generateParametersFn: function generateParametersFn() {
          return [{ sourceLocation: testCase.sourceLocation, pickle: pickle, result: result }];
        },
        stepDefinition: _lodash2.default.find(this.supportCodeLibrary.afterTestCaseHookDefinitions, ['id', testCaseHookDefinitionId]),
        world: world
      });
    }
  }, {
    key: 'runStep',
    value: function () {
      var _ref11 = (0, _bluebird.coroutine)(function* (_ref10) {
        var _this2 = this;

        var testCaseId = _ref10.testCaseId,
            stepDefinitionId = _ref10.stepDefinitionId,
            pickleArguments = _ref10.pickleArguments,
            patternMatches = _ref10.patternMatches;

        var generateParametersFn = function generateParametersFn() {
          return _this2.getStepParameters({
            pickleArguments: pickleArguments,
            patternMatches: patternMatches,
            parameterTypeNameToTransform: _this2.supportCodeLibrary.parameterTypeNameToTransform,
            world: _this2.testCases[testCaseId].world
          });
        };
        return _step_runner2.default.run({
          defaultTimeout: this.supportCodeLibrary.defaultTimeout,
          generateParametersFn: generateParametersFn,
          stepDefinition: _lodash2.default.find(this.supportCodeLibrary.stepDefinitions, ['id', stepDefinitionId]),
          world: this.testCases[testCaseId].world
        });
      });

      function runStep(_x5) {
        return _ref11.apply(this, arguments);
      }

      return runStep;
    }()
  }, {
    key: 'parseCommand',
    value: function () {
      var _ref12 = (0, _bluebird.coroutine)(function* (line, done) {
        var _this3 = this;

        var command = JSON.parse(line);
        switch (command.type) {
          case _command_types2.default.RUN_BEFORE_TEST_RUN_HOOKS:
            yield this.runTestRunHooks('beforeTestRunHookDefinitions', 'a BeforeAll');
            this.sendActionComplete({ responseTo: command.id });
            break;
          case _command_types2.default.RUN_AFTER_TEST_RUN_HOOKS:
            yield this.runTestRunHooks('afterTestRunHookDefinitions', 'an AfterAll');
            this.sendActionComplete({ responseTo: command.id });
            break;
          case _command_types2.default.INITIALIZE_TEST_CASE:
            var attachmentManager = new _attachment_manager2.default(function (_ref13) {
              var data = _ref13.data,
                  media = _ref13.media;

              _this3.eventBroadcaster.emit('test-step-attachment', {
                index: _this3.testCases[command.testCaseId].currentStepIndex,
                testCase: command.testCase,
                data: data,
                media: media
              });
            });
            this.testCases[command.testCaseId] = {
              currentStepIndex: 0,
              testCase: command.testCase,
              pickle: command.pickle,
              world: new this.supportCodeLibrary.World({
                attach: attachmentManager.create.bind(attachmentManager),
                parameters: this.worldParameters
              })
            };
            this.sendActionComplete({ responseTo: command.id });
            break;
          case _command_types2.default.RUN_BEFORE_TEST_CASE_HOOK:
            var beforeHookResult = yield this.runBeforeTestCaseHook(command);
            this.testCases[command.testCaseId].currentStepIndex += 1;
            this.sendActionComplete({
              responseTo: command.id,
              result: beforeHookResult
            });
            break;
          case _command_types2.default.RUN_AFTER_TEST_CASE_HOOK:
            var afterHookResult = yield this.runAfterTestCaseHook(command);
            this.testCases[command.testCaseId].currentStepIndex += 1;
            this.sendActionComplete({
              responseTo: command.id,
              result: afterHookResult
            });
            break;
          case _command_types2.default.RUN_TEST_STEP:
            var stepResult = yield this.runStep(command);
            this.testCases[command.testCaseId].currentStepIndex += 1;
            this.sendActionComplete({
              responseTo: command.id,
              result: stepResult
            });
            break;
          case _command_types2.default.GENERATE_SNIPPET:
            this.sendActionComplete({
              responseTo: command.id,
              snippet: this.stepDefinitionSnippetBuilder.build(command)
            });
            break;
          case _command_types2.default.EVENT:
            this.eventBroadcaster.emit(command.event.type, command.event);
            if (command.event.type === 'test-run-finished') {
              this.result = command.event.result;
              this.pickleRunner.stdin.end();
            }
            if (command.event.type === 'attachment' && command.event.media.type === 'text/x.cucumber.stacktrace+plain') {
              throw new Error('Parse error in \'' + _path2.default.relative(this.cwd, command.event.source.uri) + '\': ' + command.event.data);
            }
            break;
          case _command_types2.default.ERROR:
            throw new Error(command.error);
          default:
            throw new Error('Unexpected message from pickle runner: ' + line);
        }
      });

      function parseCommand(_x6, _x7) {
        return _ref12.apply(this, arguments);
      }

      return parseCommand;
    }()
  }, {
    key: 'sendActionComplete',
    value: function sendActionComplete() {
      var data = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

      this.pickleRunner.stdin.write(JSON.stringify((0, _extends3.default)({
        command: _command_types2.default.ACTION_COMPLETE
      }, data)) + '\n');
    }
  }, {
    key: 'run',
    value: function run() {
      var _this4 = this;

      return new _bluebird2.default(function (resolve, reject) {
        if (_this4.filterStacktraces) {
          _this4.stackTraceFilter.filter();
        }
        _this4.pickleRunner = _child_process2.default.spawn(pickleRunner.getBinaryLocalPath(), [], {
          stdio: ['pipe', 'pipe', process.stderr]
        });
        _this4.pickleRunner.on('exit', function () {
          if (!_this4.result) {
            reject(new Error('Pickle runner exited unexpectedly'));
            return;
          }
          if (_this4.filterStacktraces) {
            _this4.stackTraceFilter.unfilter();
          }
          resolve(_this4.result.success);
        });
        var rl = _readline2.default.createInterface({ input: _this4.pickleRunner.stdout });
        rl.on('line', function () {
          var _ref14 = (0, _bluebird.coroutine)(function* (line) {
            try {
              yield _this4.parseCommand(line);
            } catch (error) {
              reject(error);
              _this4.pickleRunner.kill();
            }
          });

          return function (_x9) {
            return _ref14.apply(this, arguments);
          };
        }());
        rl.on('close', function () {
          if (!_this4.result) {
            reject(new Error('Pickle runner closed stdout unexpectedly'));
          }
        });
        _this4.pickleRunner.stdin.write(JSON.stringify({
          baseDirectory: _this4.cwd,
          featuresConfig: _this4.featuresConfig,
          runtimeConfig: _this4.runtimeConfig,
          supportCodeConfig: {
            afterTestCaseHookDefinitions: _this4.supportCodeLibrary.afterTestCaseHookDefinitions.map(function (d) {
              return d.toConfig();
            }),
            beforeTestCaseHookDefinitions: _this4.supportCodeLibrary.beforeTestCaseHookDefinitions.map(function (d) {
              return d.toConfig();
            }),
            parameterTypes: _this4.supportCodeLibrary.parameterTypes,
            stepDefinitions: _this4.supportCodeLibrary.stepDefinitions.map(function (d) {
              return d.toConfig();
            })
          },
          type: 'start'
        }) + '\n');
      });
    }
  }]);
  return Runtime;
}();

exports.default = Runtime;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9ydW50aW1lL3NoYXJlZC9pbmRleC5qcyJdLCJuYW1lcyI6WyJwaWNrbGVSdW5uZXIiLCJSdW50aW1lIiwiY3dkIiwiZXZlbnRCcm9hZGNhc3RlciIsImZlYXR1cmVzQ29uZmlnIiwicnVudGltZUNvbmZpZyIsInN0ZXBEZWZpbml0aW9uU25pcHBldEJ1aWxkZXIiLCJzdXBwb3J0Q29kZUxpYnJhcnkiLCJmaWx0ZXJTdGFja3RyYWNlcyIsIndvcmxkUGFyYW1ldGVycyIsInN0YWNrVHJhY2VGaWx0ZXIiLCJ0ZXN0Q2FzZXMiLCJwYXR0ZXJuTWF0Y2hlcyIsInBpY2tsZUFyZ3VtZW50cyIsInBhcmFtZXRlclR5cGVOYW1lVG9UcmFuc2Zvcm0iLCJ3b3JsZCIsInN0ZXBQYXR0ZXJuUGFyYW1ldGVycyIsIm1hcCIsImNhcHR1cmVzIiwicGFyYW1ldGVyVHlwZU5hbWUiLCJ0cmFuc2Zvcm0iLCJjIiwicmVzb2x2ZSIsImFwcGx5IiwiaXRlcmF0b3IiLCJkYXRhVGFibGUiLCJhcmciLCJkb2NTdHJpbmciLCJjb250ZW50Iiwic3RlcEFyZ3VtZW50UGFyYW1ldGVycyIsImNvbmNhdCIsImtleSIsIm5hbWUiLCJlYWNoIiwiaG9va0RlZmluaXRpb24iLCJydW4iLCJhcmdzQXJyYXkiLCJmbiIsImNvZGUiLCJ0aGlzQXJnIiwidGltZW91dEluTWlsbGlzZWNvbmRzIiwib3B0aW9ucyIsInRpbWVvdXQiLCJkZWZhdWx0VGltZW91dCIsImVycm9yIiwibG9jYXRpb24iLCJ0ZXN0Q2FzZUlkIiwidGVzdENhc2VIb29rRGVmaW5pdGlvbklkIiwicGlja2xlIiwidGVzdENhc2UiLCJnZW5lcmF0ZVBhcmFtZXRlcnNGbiIsInNvdXJjZUxvY2F0aW9uIiwic3RlcERlZmluaXRpb24iLCJmaW5kIiwiYmVmb3JlVGVzdENhc2VIb29rRGVmaW5pdGlvbnMiLCJyZXN1bHQiLCJhZnRlclRlc3RDYXNlSG9va0RlZmluaXRpb25zIiwic3RlcERlZmluaXRpb25JZCIsImdldFN0ZXBQYXJhbWV0ZXJzIiwic3RlcERlZmluaXRpb25zIiwibGluZSIsImRvbmUiLCJjb21tYW5kIiwiSlNPTiIsInBhcnNlIiwidHlwZSIsIlJVTl9CRUZPUkVfVEVTVF9SVU5fSE9PS1MiLCJydW5UZXN0UnVuSG9va3MiLCJzZW5kQWN0aW9uQ29tcGxldGUiLCJyZXNwb25zZVRvIiwiaWQiLCJSVU5fQUZURVJfVEVTVF9SVU5fSE9PS1MiLCJJTklUSUFMSVpFX1RFU1RfQ0FTRSIsImF0dGFjaG1lbnRNYW5hZ2VyIiwiZGF0YSIsIm1lZGlhIiwiZW1pdCIsImluZGV4IiwiY3VycmVudFN0ZXBJbmRleCIsIldvcmxkIiwiYXR0YWNoIiwiY3JlYXRlIiwicGFyYW1ldGVycyIsIlJVTl9CRUZPUkVfVEVTVF9DQVNFX0hPT0siLCJiZWZvcmVIb29rUmVzdWx0IiwicnVuQmVmb3JlVGVzdENhc2VIb29rIiwiUlVOX0FGVEVSX1RFU1RfQ0FTRV9IT09LIiwiYWZ0ZXJIb29rUmVzdWx0IiwicnVuQWZ0ZXJUZXN0Q2FzZUhvb2siLCJSVU5fVEVTVF9TVEVQIiwic3RlcFJlc3VsdCIsInJ1blN0ZXAiLCJHRU5FUkFURV9TTklQUEVUIiwic25pcHBldCIsImJ1aWxkIiwiRVZFTlQiLCJldmVudCIsInN0ZGluIiwiZW5kIiwiRXJyb3IiLCJyZWxhdGl2ZSIsInNvdXJjZSIsInVyaSIsIkVSUk9SIiwid3JpdGUiLCJzdHJpbmdpZnkiLCJBQ1RJT05fQ09NUExFVEUiLCJyZWplY3QiLCJmaWx0ZXIiLCJzcGF3biIsImdldEJpbmFyeUxvY2FsUGF0aCIsInN0ZGlvIiwicHJvY2VzcyIsInN0ZGVyciIsIm9uIiwidW5maWx0ZXIiLCJzdWNjZXNzIiwicmwiLCJjcmVhdGVJbnRlcmZhY2UiLCJpbnB1dCIsInN0ZG91dCIsInBhcnNlQ29tbWFuZCIsImtpbGwiLCJiYXNlRGlyZWN0b3J5Iiwic3VwcG9ydENvZGVDb25maWciLCJkIiwidG9Db25maWciLCJwYXJhbWV0ZXJUeXBlcyJdLCJtYXBwaW5ncyI6Ijs7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QUNia0IseUJBQWUsT0FBS3pILEdBRFA7QUFFYkUsMEJBQWdCLE9BQUtBLGNBRlI7QUFHYkMseUJBQWUsT0FBS0EsYUFIUDtBQUlidUgsNkJBQW1CO0FBQ2pCcEUsMENBQThCLE9BQUtqRCxrQkFBTCxDQUF3QmlELDRCQUF4QixDQUFxRHZDLEdBQXJELENBQzVCO0FBQUEscUJBQUs0RyxFQUFFQyxRQUFGLEVBQUw7QUFBQSxhQUQ0QixDQURiO0FBSWpCeEUsMkNBQStCLE9BQUsvQyxrQkFBTCxDQUF3QitDLDZCQUF4QixDQUFzRHJDLEdBQXRELENBQzdCO0FBQUEscUJBQUs0RyxFQUFFQyxRQUFGLEVBQUw7QUFBQSxhQUQ2QixDQUpkO0FBT2pCQyw0QkFBZ0IsT0FBS3hILGtCQUFMLENBQXdCd0gsY0FQdkI7QUFRakJwRSw2QkFBaUIsT0FBS3BELGtCQUFMLENBQXdCb0QsZUFBeEIsQ0FBd0MxQyxHQUF4QyxDQUE0QztBQUFBLHFCQUMzRDRHLEVBQUVDLFFBQUYsRUFEMkQ7QUFBQSxhQUE1QztBQVJBLFdBSk47QUFnQmI3RCxnQkFBTTtBQWhCTyxTQUFmLElBaUJLLElBbEJQO0FBb0JELE9BdkRNLENBQVA7QUF3REQ7Ozs7O2tCQTNSa0JoRSxPIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJ1xuaW1wb3J0IHsgZm9ybWF0TG9jYXRpb24gfSBmcm9tICcuLi8uLi9mb3JtYXR0ZXIvaGVscGVycydcbmltcG9ydCBQcm9taXNlIGZyb20gJ2JsdWViaXJkJ1xuaW1wb3J0IFN0YWNrVHJhY2VGaWx0ZXIgZnJvbSAnLi4vc3RhY2tfdHJhY2VfZmlsdGVyJ1xuaW1wb3J0IFVzZXJDb2RlUnVubmVyIGZyb20gJy4uLy4uL3VzZXJfY29kZV9ydW5uZXInXG5pbXBvcnQgVkVycm9yIGZyb20gJ3ZlcnJvcidcbmltcG9ydCBjaGlsZFByb2Nlc3MgZnJvbSAnY2hpbGRfcHJvY2VzcydcbmltcG9ydCByZWFkbGluZSBmcm9tICdyZWFkbGluZSdcbmltcG9ydCBjb21tYW5kVHlwZXMgZnJvbSAnLi9jb21tYW5kX3R5cGVzJ1xuaW1wb3J0IEF0dGFjaG1lbnRNYW5hZ2VyIGZyb20gJy4uL2F0dGFjaG1lbnRfbWFuYWdlcidcbmltcG9ydCB7IGJ1aWxkU3RlcEFyZ3VtZW50SXRlcmF0b3IgfSBmcm9tICcuLi8uLi9zdGVwX2FyZ3VtZW50cydcbmltcG9ydCBEYXRhVGFibGUgZnJvbSAnLi4vLi4vbW9kZWxzL2RhdGFfdGFibGUnXG5pbXBvcnQgU3RlcFJ1bm5lciBmcm9tICcuLi9zdGVwX3J1bm5lcidcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnXG5pbXBvcnQgKiBhcyBwaWNrbGVSdW5uZXIgZnJvbSAnLi4vLi4vcGlja2xlX3J1bm5lcidcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUnVudGltZSB7XG4gIC8vIGZlYXR1cmVzQ29uZmlnIC0ge2Fic29sdXRlUGF0aHMsIGRlZmF1bHRMYW5ndWFnZSwgb3JkZXJTZWVkLCBmaWx0ZXJzfVxuICAvLyAgIGZpbHRlcnMgLSB7bmFtZXMsIGxpbmVzLCB0YWdFeHByZXNzaW9ufVxuICAvLyAgICAgbGluZXMgLSB7IFtmZWF0dXJlUGF0aF06IFtsaW5lMSwgbGluZTIsIC4uLl0sIC4uLiB9XG4gIC8vIHJ1bnRpbWVDb25maWcgLSB7aXNEcnlSdW4sIGlzRmFpbEZhc3QsIGlzU3RyaWN0fVxuICBjb25zdHJ1Y3Rvcih7XG4gICAgY3dkLFxuICAgIGV2ZW50QnJvYWRjYXN0ZXIsXG4gICAgZmVhdHVyZXNDb25maWcsXG4gICAgcnVudGltZUNvbmZpZyxcbiAgICBzdGVwRGVmaW5pdGlvblNuaXBwZXRCdWlsZGVyLFxuICAgIHN1cHBvcnRDb2RlTGlicmFyeSxcbiAgICBmaWx0ZXJTdGFja3RyYWNlcyxcbiAgICB3b3JsZFBhcmFtZXRlcnMsXG4gIH0pIHtcbiAgICB0aGlzLmN3ZCA9IGN3ZFxuICAgIHRoaXMuZXZlbnRCcm9hZGNhc3RlciA9IGV2ZW50QnJvYWRjYXN0ZXJcbiAgICB0aGlzLmZlYXR1cmVzQ29uZmlnID0gZmVhdHVyZXNDb25maWdcbiAgICB0aGlzLnJ1bnRpbWVDb25maWcgPSBydW50aW1lQ29uZmlnXG4gICAgdGhpcy5maWx0ZXJTdGFja3RyYWNlcyA9IGZpbHRlclN0YWNrdHJhY2VzXG4gICAgdGhpcy5zdGFja1RyYWNlRmlsdGVyID0gbmV3IFN0YWNrVHJhY2VGaWx0ZXIoKVxuICAgIHRoaXMuc3RlcERlZmluaXRpb25TbmlwcGV0QnVpbGRlciA9IHN0ZXBEZWZpbml0aW9uU25pcHBldEJ1aWxkZXJcbiAgICB0aGlzLnN1cHBvcnRDb2RlTGlicmFyeSA9IHN1cHBvcnRDb2RlTGlicmFyeVxuICAgIHRoaXMud29ybGRQYXJhbWV0ZXJzID0gd29ybGRQYXJhbWV0ZXJzXG4gICAgdGhpcy50ZXN0Q2FzZXMgPSB7fVxuICB9XG5cbiAgYXN5bmMgZ2V0U3RlcFBhcmFtZXRlcnMoe1xuICAgIHBhdHRlcm5NYXRjaGVzLFxuICAgIHBpY2tsZUFyZ3VtZW50cyxcbiAgICBwYXJhbWV0ZXJUeXBlTmFtZVRvVHJhbnNmb3JtLFxuICAgIHdvcmxkLFxuICB9KSB7XG4gICAgY29uc3Qgc3RlcFBhdHRlcm5QYXJhbWV0ZXJzID0gYXdhaXQgUHJvbWlzZS5tYXAoXG4gICAgICBwYXR0ZXJuTWF0Y2hlcyxcbiAgICAgICh7IGNhcHR1cmVzLCBwYXJhbWV0ZXJUeXBlTmFtZSB9KSA9PiB7XG4gICAgICAgIGNvbnN0IHRyYW5zZm9ybSA9XG4gICAgICAgICAgcGFyYW1ldGVyVHlwZU5hbWVUb1RyYW5zZm9ybVtwYXJhbWV0ZXJUeXBlTmFtZV0gfHxcbiAgICAgICAgICBmdW5jdGlvbihjKSB7XG4gICAgICAgICAgICByZXR1cm4gY1xuICAgICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0cmFuc2Zvcm0uYXBwbHkod29ybGQsIGNhcHR1cmVzKSlcbiAgICAgIH1cbiAgICApXG4gICAgY29uc3QgaXRlcmF0b3IgPSBidWlsZFN0ZXBBcmd1bWVudEl0ZXJhdG9yKHtcbiAgICAgIGRhdGFUYWJsZTogYXJnID0+IG5ldyBEYXRhVGFibGUoYXJnKSxcbiAgICAgIGRvY1N0cmluZzogYXJnID0+IGFyZy5jb250ZW50LFxuICAgIH0pXG4gICAgY29uc3Qgc3RlcEFyZ3VtZW50UGFyYW1ldGVycyA9IHBpY2tsZUFyZ3VtZW50cy5tYXAoaXRlcmF0b3IpXG4gICAgcmV0dXJuIHN0ZXBQYXR0ZXJuUGFyYW1ldGVycy5jb25jYXQoc3RlcEFyZ3VtZW50UGFyYW1ldGVycylcbiAgfVxuXG4gIGFzeW5jIHJ1blRlc3RSdW5Ib29rcyhrZXksIG5hbWUpIHtcbiAgICBhd2FpdCBQcm9taXNlLmVhY2godGhpcy5zdXBwb3J0Q29kZUxpYnJhcnlba2V5XSwgYXN5bmMgaG9va0RlZmluaXRpb24gPT4ge1xuICAgICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgVXNlckNvZGVSdW5uZXIucnVuKHtcbiAgICAgICAgYXJnc0FycmF5OiBbXSxcbiAgICAgICAgZm46IGhvb2tEZWZpbml0aW9uLmNvZGUsXG4gICAgICAgIHRoaXNBcmc6IG51bGwsXG4gICAgICAgIHRpbWVvdXRJbk1pbGxpc2Vjb25kczpcbiAgICAgICAgICBob29rRGVmaW5pdGlvbi5vcHRpb25zLnRpbWVvdXQgfHxcbiAgICAgICAgICB0aGlzLnN1cHBvcnRDb2RlTGlicmFyeS5kZWZhdWx0VGltZW91dCxcbiAgICAgIH0pXG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgY29uc3QgbG9jYXRpb24gPSBmb3JtYXRMb2NhdGlvbihob29rRGVmaW5pdGlvbiwgdGhpcy5jd2QpXG4gICAgICAgIHRocm93IG5ldyBWRXJyb3IoXG4gICAgICAgICAgZXJyb3IsXG4gICAgICAgICAgYCR7bmFtZX0gaG9vayBlcnJvcmVkLCBwcm9jZXNzIGV4aXRpbmc6ICR7bG9jYXRpb259YFxuICAgICAgICApXG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG4gIHJ1bkJlZm9yZVRlc3RDYXNlSG9vayh7IHRlc3RDYXNlSWQsIHRlc3RDYXNlSG9va0RlZmluaXRpb25JZCB9KSB7XG4gICAgY29uc3QgeyB3b3JsZCwgcGlja2xlLCB0ZXN0Q2FzZSB9ID0gdGhpcy50ZXN0Q2FzZXNbdGVzdENhc2VJZF1cbiAgICByZXR1cm4gU3RlcFJ1bm5lci5ydW4oe1xuICAgICAgZGVmYXVsdFRpbWVvdXQ6IHRoaXMuc3VwcG9ydENvZGVMaWJyYXJ5LmRlZmF1bHRUaW1lb3V0LFxuICAgICAgZ2VuZXJhdGVQYXJhbWV0ZXJzRm46ICgpID0+IFtcbiAgICAgICAgeyBzb3VyY2VMb2NhdGlvbjogdGVzdENhc2Uuc291cmNlTG9jYXRpb24sIHBpY2tsZSB9LFxuICAgICAgXSxcbiAgICAgIHN0ZXBEZWZpbml0aW9uOiBfLmZpbmQoXG4gICAgICAgIHRoaXMuc3VwcG9ydENvZGVMaWJyYXJ5LmJlZm9yZVRlc3RDYXNlSG9va0RlZmluaXRpb25zLFxuICAgICAgICBbJ2lkJywgdGVzdENhc2VIb29rRGVmaW5pdGlvbklkXVxuICAgICAgKSxcbiAgICAgIHdvcmxkLFxuICAgIH0pXG4gIH1cblxuICBydW5BZnRlclRlc3RDYXNlSG9vayh7IHRlc3RDYXNlSWQsIHRlc3RDYXNlSG9va0RlZmluaXRpb25JZCwgcmVzdWx0IH0pIHtcbiAgICBjb25zdCB7IHdvcmxkLCBwaWNrbGUsIHRlc3RDYXNlIH0gPSB0aGlzLnRlc3RDYXNlc1t0ZXN0Q2FzZUlkXVxuICAgIHJldHVybiBTdGVwUnVubmVyLnJ1bih7XG4gICAgICBkZWZhdWx0VGltZW91dDogdGhpcy5zdXBwb3J0Q29kZUxpYnJhcnkuZGVmYXVsdFRpbWVvdXQsXG4gICAgICBnZW5lcmF0ZVBhcmFtZXRlcnNGbjogKCkgPT4gW1xuICAgICAgICB7IHNvdXJjZUxvY2F0aW9uOiB0ZXN0Q2FzZS5zb3VyY2VMb2NhdGlvbiwgcGlja2xlLCByZXN1bHQgfSxcbiAgICAgIF0sXG4gICAgICBzdGVwRGVmaW5pdGlvbjogXy5maW5kKFxuICAgICAgICB0aGlzLnN1cHBvcnRDb2RlTGlicmFyeS5hZnRlclRlc3RDYXNlSG9va0RlZmluaXRpb25zLFxuICAgICAgICBbJ2lkJywgdGVzdENhc2VIb29rRGVmaW5pdGlvbklkXVxuICAgICAgKSxcbiAgICAgIHdvcmxkLFxuICAgIH0pXG4gIH1cblxuICBhc3luYyBydW5TdGVwKHtcbiAgICB0ZXN0Q2FzZUlkLFxuICAgIHN0ZXBEZWZpbml0aW9uSWQsXG4gICAgcGlja2xlQXJndW1lbnRzLFxuICAgIHBhdHRlcm5NYXRjaGVzLFxuICB9KSB7XG4gICAgY29uc3QgZ2VuZXJhdGVQYXJhbWV0ZXJzRm4gPSAoKSA9PiB7XG4gICAgICByZXR1cm4gdGhpcy5nZXRTdGVwUGFyYW1ldGVycyh7XG4gICAgICAgIHBpY2tsZUFyZ3VtZW50cyxcbiAgICAgICAgcGF0dGVybk1hdGNoZXMsXG4gICAgICAgIHBhcmFtZXRlclR5cGVOYW1lVG9UcmFuc2Zvcm06IHRoaXMuc3VwcG9ydENvZGVMaWJyYXJ5XG4gICAgICAgICAgLnBhcmFtZXRlclR5cGVOYW1lVG9UcmFuc2Zvcm0sXG4gICAgICAgIHdvcmxkOiB0aGlzLnRlc3RDYXNlc1t0ZXN0Q2FzZUlkXS53b3JsZCxcbiAgICAgIH0pXG4gICAgfVxuICAgIHJldHVybiBTdGVwUnVubmVyLnJ1bih7XG4gICAgICBkZWZhdWx0VGltZW91dDogdGhpcy5zdXBwb3J0Q29kZUxpYnJhcnkuZGVmYXVsdFRpbWVvdXQsXG4gICAgICBnZW5lcmF0ZVBhcmFtZXRlcnNGbixcbiAgICAgIHN0ZXBEZWZpbml0aW9uOiBfLmZpbmQodGhpcy5zdXBwb3J0Q29kZUxpYnJhcnkuc3RlcERlZmluaXRpb25zLCBbXG4gICAgICAgICdpZCcsXG4gICAgICAgIHN0ZXBEZWZpbml0aW9uSWQsXG4gICAgICBdKSxcbiAgICAgIHdvcmxkOiB0aGlzLnRlc3RDYXNlc1t0ZXN0Q2FzZUlkXS53b3JsZCxcbiAgICB9KVxuICB9XG5cbiAgYXN5bmMgcGFyc2VDb21tYW5kKGxpbmUsIGRvbmUpIHtcbiAgICBjb25zdCBjb21tYW5kID0gSlNPTi5wYXJzZShsaW5lKVxuICAgIHN3aXRjaCAoY29tbWFuZC50eXBlKSB7XG4gICAgICBjYXNlIGNvbW1hbmRUeXBlcy5SVU5fQkVGT1JFX1RFU1RfUlVOX0hPT0tTOlxuICAgICAgICBhd2FpdCB0aGlzLnJ1blRlc3RSdW5Ib29rcyhcbiAgICAgICAgICAnYmVmb3JlVGVzdFJ1bkhvb2tEZWZpbml0aW9ucycsXG4gICAgICAgICAgJ2EgQmVmb3JlQWxsJ1xuICAgICAgICApXG4gICAgICAgIHRoaXMuc2VuZEFjdGlvbkNvbXBsZXRlKHsgcmVzcG9uc2VUbzogY29tbWFuZC5pZCB9KVxuICAgICAgICBicmVha1xuICAgICAgY2FzZSBjb21tYW5kVHlwZXMuUlVOX0FGVEVSX1RFU1RfUlVOX0hPT0tTOlxuICAgICAgICBhd2FpdCB0aGlzLnJ1blRlc3RSdW5Ib29rcygnYWZ0ZXJUZXN0UnVuSG9va0RlZmluaXRpb25zJywgJ2FuIEFmdGVyQWxsJylcbiAgICAgICAgdGhpcy5zZW5kQWN0aW9uQ29tcGxldGUoeyByZXNwb25zZVRvOiBjb21tYW5kLmlkIH0pXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlIGNvbW1hbmRUeXBlcy5JTklUSUFMSVpFX1RFU1RfQ0FTRTpcbiAgICAgICAgY29uc3QgYXR0YWNobWVudE1hbmFnZXIgPSBuZXcgQXR0YWNobWVudE1hbmFnZXIoKHsgZGF0YSwgbWVkaWEgfSkgPT4ge1xuICAgICAgICAgIHRoaXMuZXZlbnRCcm9hZGNhc3Rlci5lbWl0KCd0ZXN0LXN0ZXAtYXR0YWNobWVudCcsIHtcbiAgICAgICAgICAgIGluZGV4OiB0aGlzLnRlc3RDYXNlc1tjb21tYW5kLnRlc3RDYXNlSWRdLmN1cnJlbnRTdGVwSW5kZXgsXG4gICAgICAgICAgICB0ZXN0Q2FzZTogY29tbWFuZC50ZXN0Q2FzZSxcbiAgICAgICAgICAgIGRhdGEsXG4gICAgICAgICAgICBtZWRpYSxcbiAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgICAgICB0aGlzLnRlc3RDYXNlc1tjb21tYW5kLnRlc3RDYXNlSWRdID0ge1xuICAgICAgICAgIGN1cnJlbnRTdGVwSW5kZXg6IDAsXG4gICAgICAgICAgdGVzdENhc2U6IGNvbW1hbmQudGVzdENhc2UsXG4gICAgICAgICAgcGlja2xlOiBjb21tYW5kLnBpY2tsZSxcbiAgICAgICAgICB3b3JsZDogbmV3IHRoaXMuc3VwcG9ydENvZGVMaWJyYXJ5LldvcmxkKHtcbiAgICAgICAgICAgIGF0dGFjaDogOjphdHRhY2htZW50TWFuYWdlci5jcmVhdGUsXG4gICAgICAgICAgICBwYXJhbWV0ZXJzOiB0aGlzLndvcmxkUGFyYW1ldGVycyxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNlbmRBY3Rpb25Db21wbGV0ZSh7IHJlc3BvbnNlVG86IGNvbW1hbmQuaWQgfSlcbiAgICAgICAgYnJlYWtcbiAgICAgIGNhc2UgY29tbWFuZFR5cGVzLlJVTl9CRUZPUkVfVEVTVF9DQVNFX0hPT0s6XG4gICAgICAgIGNvbnN0IGJlZm9yZUhvb2tSZXN1bHQgPSBhd2FpdCB0aGlzLnJ1bkJlZm9yZVRlc3RDYXNlSG9vayhjb21tYW5kKVxuICAgICAgICB0aGlzLnRlc3RDYXNlc1tjb21tYW5kLnRlc3RDYXNlSWRdLmN1cnJlbnRTdGVwSW5kZXggKz0gMVxuICAgICAgICB0aGlzLnNlbmRBY3Rpb25Db21wbGV0ZSh7XG4gICAgICAgICAgcmVzcG9uc2VUbzogY29tbWFuZC5pZCxcbiAgICAgICAgICByZXN1bHQ6IGJlZm9yZUhvb2tSZXN1bHQsXG4gICAgICAgIH0pXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlIGNvbW1hbmRUeXBlcy5SVU5fQUZURVJfVEVTVF9DQVNFX0hPT0s6XG4gICAgICAgIGNvbnN0IGFmdGVySG9va1Jlc3VsdCA9IGF3YWl0IHRoaXMucnVuQWZ0ZXJUZXN0Q2FzZUhvb2soY29tbWFuZClcbiAgICAgICAgdGhpcy50ZXN0Q2FzZXNbY29tbWFuZC50ZXN0Q2FzZUlkXS5jdXJyZW50U3RlcEluZGV4ICs9IDFcbiAgICAgICAgdGhpcy5zZW5kQWN0aW9uQ29tcGxldGUoe1xuICAgICAgICAgIHJlc3BvbnNlVG86IGNvbW1hbmQuaWQsXG4gICAgICAgICAgcmVzdWx0OiBhZnRlckhvb2tSZXN1bHQsXG4gICAgICAgIH0pXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlIGNvbW1hbmRUeXBlcy5SVU5fVEVTVF9TVEVQOlxuICAgICAgICBjb25zdCBzdGVwUmVzdWx0ID0gYXdhaXQgdGhpcy5ydW5TdGVwKGNvbW1hbmQpXG4gICAgICAgIHRoaXMudGVzdENhc2VzW2NvbW1hbmQudGVzdENhc2VJZF0uY3VycmVudFN0ZXBJbmRleCArPSAxXG4gICAgICAgIHRoaXMuc2VuZEFjdGlvbkNvbXBsZXRlKHtcbiAgICAgICAgICByZXNwb25zZVRvOiBjb21tYW5kLmlkLFxuICAgICAgICAgIHJlc3VsdDogc3RlcFJlc3VsdCxcbiAgICAgICAgfSlcbiAgICAgICAgYnJlYWtcbiAgICAgIGNhc2UgY29tbWFuZFR5cGVzLkdFTkVSQVRFX1NOSVBQRVQ6XG4gICAgICAgIHRoaXMuc2VuZEFjdGlvbkNvbXBsZXRlKHtcbiAgICAgICAgICByZXNwb25zZVRvOiBjb21tYW5kLmlkLFxuICAgICAgICAgIHNuaXBwZXQ6IHRoaXMuc3RlcERlZmluaXRpb25TbmlwcGV0QnVpbGRlci5idWlsZChjb21tYW5kKSxcbiAgICAgICAgfSlcbiAgICAgICAgYnJlYWtcbiAgICAgIGNhc2UgY29tbWFuZFR5cGVzLkVWRU5UOlxuICAgICAgICB0aGlzLmV2ZW50QnJvYWRjYXN0ZXIuZW1pdChjb21tYW5kLmV2ZW50LnR5cGUsIGNvbW1hbmQuZXZlbnQpXG4gICAgICAgIGlmIChjb21tYW5kLmV2ZW50LnR5cGUgPT09ICd0ZXN0LXJ1bi1maW5pc2hlZCcpIHtcbiAgICAgICAgICB0aGlzLnJlc3VsdCA9IGNvbW1hbmQuZXZlbnQucmVzdWx0XG4gICAgICAgICAgdGhpcy5waWNrbGVSdW5uZXIuc3RkaW4uZW5kKClcbiAgICAgICAgfVxuICAgICAgICBpZiAoXG4gICAgICAgICAgY29tbWFuZC5ldmVudC50eXBlID09PSAnYXR0YWNobWVudCcgJiZcbiAgICAgICAgICBjb21tYW5kLmV2ZW50Lm1lZGlhLnR5cGUgPT09ICd0ZXh0L3guY3VjdW1iZXIuc3RhY2t0cmFjZStwbGFpbidcbiAgICAgICAgKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgYFBhcnNlIGVycm9yIGluICcke3BhdGgucmVsYXRpdmUoXG4gICAgICAgICAgICAgIHRoaXMuY3dkLFxuICAgICAgICAgICAgICBjb21tYW5kLmV2ZW50LnNvdXJjZS51cmlcbiAgICAgICAgICAgICl9JzogJHtjb21tYW5kLmV2ZW50LmRhdGF9YFxuICAgICAgICAgIClcbiAgICAgICAgfVxuICAgICAgICBicmVha1xuICAgICAgY2FzZSBjb21tYW5kVHlwZXMuRVJST1I6XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihjb21tYW5kLmVycm9yKVxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmV4cGVjdGVkIG1lc3NhZ2UgZnJvbSBwaWNrbGUgcnVubmVyOiAke2xpbmV9YClcbiAgICB9XG4gIH1cblxuICBzZW5kQWN0aW9uQ29tcGxldGUoZGF0YSA9IHt9KSB7XG4gICAgdGhpcy5waWNrbGVSdW5uZXIuc3RkaW4ud3JpdGUoXG4gICAgICBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGNvbW1hbmQ6IGNvbW1hbmRUeXBlcy5BQ1RJT05fQ09NUExFVEUsXG4gICAgICAgIC4uLmRhdGEsXG4gICAgICB9KSArICdcXG4nXG4gICAgKVxuICB9XG5cbiAgcnVuKCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBpZiAodGhpcy5maWx0ZXJTdGFja3RyYWNlcykge1xuICAgICAgICB0aGlzLnN0YWNrVHJhY2VGaWx0ZXIuZmlsdGVyKClcbiAgICAgIH1cbiAgICAgIHRoaXMucGlja2xlUnVubmVyID0gY2hpbGRQcm9jZXNzLnNwYXduKFxuICAgICAgICBwaWNrbGVSdW5uZXIuZ2V0QmluYXJ5TG9jYWxQYXRoKCksXG4gICAgICAgIFtdLFxuICAgICAgICB7XG4gICAgICAgICAgc3RkaW86IFsncGlwZScsICdwaXBlJywgcHJvY2Vzcy5zdGRlcnJdLFxuICAgICAgICB9XG4gICAgICApXG4gICAgICB0aGlzLnBpY2tsZVJ1bm5lci5vbignZXhpdCcsICgpID0+IHtcbiAgICAgICAgaWYgKCF0aGlzLnJlc3VsdCkge1xuICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ1BpY2tsZSBydW5uZXIgZXhpdGVkIHVuZXhwZWN0ZWRseScpKVxuICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmZpbHRlclN0YWNrdHJhY2VzKSB7XG4gICAgICAgICAgdGhpcy5zdGFja1RyYWNlRmlsdGVyLnVuZmlsdGVyKClcbiAgICAgICAgfVxuICAgICAgICByZXNvbHZlKHRoaXMucmVzdWx0LnN1Y2Nlc3MpXG4gICAgICB9KVxuICAgICAgY29uc3QgcmwgPSByZWFkbGluZS5jcmVhdGVJbnRlcmZhY2UoeyBpbnB1dDogdGhpcy5waWNrbGVSdW5uZXIuc3Rkb3V0IH0pXG4gICAgICBybC5vbignbGluZScsIGFzeW5jIGxpbmUgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGF3YWl0IHRoaXMucGFyc2VDb21tYW5kKGxpbmUpXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgcmVqZWN0KGVycm9yKVxuICAgICAgICAgIHRoaXMucGlja2xlUnVubmVyLmtpbGwoKVxuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgcmwub24oJ2Nsb3NlJywgKCkgPT4ge1xuICAgICAgICBpZiAoIXRoaXMucmVzdWx0KSB7XG4gICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignUGlja2xlIHJ1bm5lciBjbG9zZWQgc3Rkb3V0IHVuZXhwZWN0ZWRseScpKVxuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgdGhpcy5waWNrbGVSdW5uZXIuc3RkaW4ud3JpdGUoXG4gICAgICAgIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBiYXNlRGlyZWN0b3J5OiB0aGlzLmN3ZCxcbiAgICAgICAgICBmZWF0dXJlc0NvbmZpZzogdGhpcy5mZWF0dXJlc0NvbmZpZyxcbiAgICAgICAgICBydW50aW1lQ29uZmlnOiB0aGlzLnJ1bnRpbWVDb25maWcsXG4gICAgICAgICAgc3VwcG9ydENvZGVDb25maWc6IHtcbiAgICAgICAgICAgIGFmdGVyVGVzdENhc2VIb29rRGVmaW5pdGlvbnM6IHRoaXMuc3VwcG9ydENvZGVMaWJyYXJ5LmFmdGVyVGVzdENhc2VIb29rRGVmaW5pdGlvbnMubWFwKFxuICAgICAgICAgICAgICBkID0+IGQudG9Db25maWcoKVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIGJlZm9yZVRlc3RDYXNlSG9va0RlZmluaXRpb25zOiB0aGlzLnN1cHBvcnRDb2RlTGlicmFyeS5iZWZvcmVUZXN0Q2FzZUhvb2tEZWZpbml0aW9ucy5tYXAoXG4gICAgICAgICAgICAgIGQgPT4gZC50b0NvbmZpZygpXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgcGFyYW1ldGVyVHlwZXM6IHRoaXMuc3VwcG9ydENvZGVMaWJyYXJ5LnBhcmFtZXRlclR5cGVzLFxuICAgICAgICAgICAgc3RlcERlZmluaXRpb25zOiB0aGlzLnN1cHBvcnRDb2RlTGlicmFyeS5zdGVwRGVmaW5pdGlvbnMubWFwKGQgPT5cbiAgICAgICAgICAgICAgZC50b0NvbmZpZygpXG4gICAgICAgICAgICApLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgdHlwZTogJ3N0YXJ0JyxcbiAgICAgICAgfSkgKyAnXFxuJ1xuICAgICAgKVxuICAgIH0pXG4gIH1cbn1cbiJdfQ==